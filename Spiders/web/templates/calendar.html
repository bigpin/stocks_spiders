<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>股票信号时间轴视图</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/calendar.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <div class="header-title">
                    <span class="header-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2" fill="none"/>
                            <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2"/>
                            <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            <circle cx="12" cy="15" r="1.5" fill="currentColor"/>
                            <circle cx="8" cy="15" r="1.5" fill="currentColor"/>
                            <circle cx="16" cy="15" r="1.5" fill="currentColor"/>
                            <line x1="8" y1="15" x2="16" y2="15" stroke="currentColor" stroke-width="1.5"/>
                        </svg>
                    </span>
                    股票信号垂直时间轴视图
                </div>
                <div class="header-subtitle">垂直时间轴，鼠标滚轮缩放，点击选中股票</div>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="window.location.href='/list'">返回列表视图</button>
            </div>
        </div>

        <div class="content-wrapper">
            <button class="sidebar-toggle" id="sidebar-toggle" title="收起/展开筛选区">
                <svg class="toggle-icon" viewBox="0 0 24 24">
                    <path d="M15 18l-6-6 6-6"/>
                </svg>
            </button>
            <div class="sidebar" id="sidebar">
                <!-- Timeline Controls -->
                <div class="controls" id="timeline-controls">
                    <div class="controls-row">
                        <div class="control-group">
                            <div class="control-label">股票代码</div>
                            <select id="filter-stock-code" class="control-input">
                                <option value="">全部</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <div class="control-label">开始日期</div>
                            <input id="filter-date-from" type="date" class="control-input">
                        </div>
                        <div class="control-group">
                            <div class="control-label">结束日期</div>
                            <input id="filter-date-to" type="date" class="control-input">
                        </div>
                    </div>
                    <div class="controls-row">
                        <div class="control-group">
                            <div class="control-label">买入价格范围</div>
                            <div style="display: flex; gap: 8px; align-items: center; width: 100%; box-sizing: border-box;">
                                <input type="number" id="filter-timeline-price-min" class="control-input" placeholder="最低价" style="flex: 1;" min="0" step="0.01">
                                <span style="flex-shrink: 0;">-</span>
                                <input type="number" id="filter-timeline-price-max" class="control-input" placeholder="最高价" style="flex: 1;" min="0" step="0.01">
                            </div>
                        </div>
                        <div class="control-group">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                <input type="checkbox" id="filter-timeline-enable-buy-day-change" style="width: 16px; height: 16px;">
                                <div class="control-label" style="margin: 0;">买入当天涨跌范围</div>
                            </div>
                            <div class="slider-group">
                                <div class="slider-container">
                                    <span class="slider-value" id="filter-timeline-buy-day-change-min-value">-10%</span>
                                    <div class="slider-wrapper">
                                        <input type="range" id="filter-timeline-buy-day-change-min" class="slider" min="-20" max="20" step="0.1" value="-10" disabled>
                                    </div>
                                    <span class="slider-value" id="filter-timeline-buy-day-change-max-value">10%</span>
                                    <div class="slider-wrapper">
                                        <input type="range" id="filter-timeline-buy-day-change-max" class="slider" min="-20" max="20" step="0.1" value="10" disabled>
                                    </div>
                                </div>
                                <div class="slider-label-row">
                                    <span>-20%</span>
                                    <span>0%</span>
                                    <span>20%</span>
                                </div>
                            </div>
                        </div>
                        <div class="control-group">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                <input type="checkbox" id="filter-timeline-enable-next-day-change" style="width: 16px; height: 16px;">
                                <div class="control-label" style="margin: 0;">第二天涨跌范围</div>
                            </div>
                            <div class="slider-group">
                                <div class="slider-container">
                                    <span class="slider-value" id="filter-timeline-next-day-change-min-value">-10%</span>
                                    <div class="slider-wrapper">
                                        <input type="range" id="filter-timeline-next-day-change-min" class="slider" min="-20" max="20" step="0.1" value="-10" disabled>
                                    </div>
                                    <span class="slider-value" id="filter-timeline-next-day-change-max-value">10%</span>
                                    <div class="slider-wrapper">
                                        <input type="range" id="filter-timeline-next-day-change-max" class="slider" min="-20" max="20" step="0.1" value="10" disabled>
                                    </div>
                                </div>
                                <div class="slider-label-row">
                                    <span>-20%</span>
                                    <span>0%</span>
                                    <span>20%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="controls-row">
                        <div class="control-group">
                            <div class="control-label">显示内容</div>
                            <div class="toggle-group">
                                <label class="toggle-item">
                                    <input type="checkbox" id="toggle-buy" checked>
                                    买入点
                                </label>
                                <label class="toggle-item">
                                    <input type="checkbox" id="toggle-sell-high" checked>
                                    最高价线
                                </label>
                                <label class="toggle-item">
                                    <input type="checkbox" id="toggle-sell-low" checked>
                                    最低价线
                                </label>
                                <label class="toggle-item">
                                    <input type="checkbox" id="toggle-show-name" checked>
                                    股票名称
                                </label>
                                <label class="toggle-item">
                                    <input type="checkbox" id="toggle-show-profit" checked>
                                    收益信息
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="controls-row">
                        <div class="control-group">
                            <div class="control-label">操作</div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn btn-primary" onclick="reloadTimeline()" style="flex: 1;">应用筛选</button>
                                <button class="btn btn-secondary" onclick="resetFilters()" style="flex: 1;">重置</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data List Controls -->
                <div class="controls" id="data-list-controls" style="display: none;">
                    <div class="controls-row">
                        <div class="control-group">
                            <div class="control-label">股票代码</div>
                            <select id="data-list-stock-code" class="control-input">
                                <option value="">全部</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <div class="control-label">股票名称</div>
                            <select id="data-list-stock-name" class="control-input">
                                <option value="">全部</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <div class="control-label">信号类型</div>
                            <select id="data-list-signal-type" class="control-input">
                                <option value="">全部</option>
                            </select>
                        </div>
                    </div>
                    <div class="controls-row">
                        <div class="control-group">
                            <div class="control-label">最低成功率 (%)</div>
                            <input type="number" id="data-list-min-success-rate" class="control-input" placeholder="如: 60" min="0" max="100">
                        </div>
                        <div class="control-group">
                            <div class="control-label">最少信号数</div>
                            <input type="number" id="data-list-min-signal-count" class="control-input" placeholder="如: 3" min="1">
                        </div>
                        <div class="control-group">
                            <div class="control-label">每页显示</div>
                            <select id="data-list-per-page" class="control-input">
                                <option value="50" selected>50条</option>
                                <option value="100">100条</option>
                                <option value="200">200条</option>
                                <option value="500">500条</option>
                            </select>
                        </div>
                    </div>
                    <div class="controls-row">
                        <div class="control-group">
                            <div class="control-label">开始日期</div>
                            <input type="date" id="data-list-date-from" class="control-input">
                        </div>
                        <div class="control-group">
                            <div class="control-label">结束日期</div>
                            <input type="date" id="data-list-date-to" class="control-input">
                        </div>
                        <div class="control-group">
                            <div class="control-label">排序方式</div>
                            <select id="data-list-sort-by" class="control-input">
                                <option value="created_at">创建时间</option>
                                <option value="overall_success_rate">成功率</option>
                                <option value="signal_count">信号数量</option>
                                <option value="insert_date">插入日期</option>
                                <option value="highest_change_rate">最高涨幅</option>
                            </select>
                        </div>
                    </div>
                    <div class="controls-row">
                        <div class="control-group">
                            <div class="control-label">排序顺序</div>
                            <select id="data-list-sort-order" class="control-input">
                                <option value="desc">降序</option>
                                <option value="asc">升序</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <div class="control-label">操作</div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn btn-primary" onclick="loadDataList(1)" style="flex: 1;">搜索</button>
                                <button class="btn btn-secondary" onclick="resetDataListFilters()" style="flex: 1;">重置</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Matrix Controls -->
                <div class="controls" id="matrix-controls" style="display: none;">
                    <div class="controls-row">
                        <div class="control-group">
                            <div class="control-label">日期区间</div>
                            <select id="filter-date-range" class="control-input">
                                <option value="" selected>全部</option>
                                <option value="7">最近7天</option>
                                <option value="14">最近14天</option>
                                <option value="30">最近一个月</option>
                                <option value="60">最近两个月</option>
                                <option value="90">最近三个月</option>
                                <option value="180">最近半年</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <div class="control-label">跟踪天数范围</div>
                            <div style="display: flex; gap: 8px; align-items: center; width: 100%; box-sizing: border-box;">
                                <input type="number" id="filter-days-min" class="control-input" placeholder="最小天数" style="flex: 1;" min="0" value="10">
                                <span style="flex-shrink: 0;">-</span>
                                <input type="number" id="filter-days-max" class="control-input" placeholder="最大天数" style="flex: 1;" min="0">
                            </div>
                        </div>
                        <div class="control-group">
                            <div class="control-label">置信百分比</div>
                            <input type="number" id="filter-confidence" class="control-input" placeholder="最小置信度%" min="0" max="100" step="0.1" value="80">
                            <span style="font-size: 11px; color: #666; margin-top: 2px;">（达到止盈/止损的股票占比）</span>
                        </div>
                    </div>
                    <div class="controls-row">
                        <div class="control-group">
                            <div class="control-label">买入价格范围</div>
                            <div style="display: flex; gap: 8px; align-items: center; width: 100%; box-sizing: border-box;">
                                <input type="number" id="filter-price-min" class="control-input" placeholder="最低价" style="flex: 1;" min="0" step="0.01">
                                <span style="flex-shrink: 0;">-</span>
                                <input type="number" id="filter-price-max" class="control-input" placeholder="最高价" style="flex: 1;" min="0" step="0.01">
                            </div>
                        </div>
                        <div class="control-group">
                            <div class="control-label">最高涨幅范围</div>
                            <div style="display: flex; gap: 8px; align-items: center; width: 100%; box-sizing: border-box;">
                                <input type="number" id="filter-high-change-min" class="control-input" placeholder="最小涨幅%" style="flex: 1;" step="0.01">
                                <span style="flex-shrink: 0;">-</span>
                                <input type="number" id="filter-high-change-max" class="control-input" placeholder="最大涨幅%" style="flex: 1;" step="0.01">
                            </div>
                        </div>
                    </div>
                    <div class="controls-row">
                        <div class="control-group">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                <input type="checkbox" id="filter-enable-buy-day-change" style="width: 16px; height: 16px;">
                                <div class="control-label" style="margin: 0;">买入当天涨跌范围</div>
                            </div>
                            <div class="slider-group">
                                <div class="slider-container">
                                    <span class="slider-value" id="filter-buy-day-change-min-value">-10%</span>
                                    <div class="slider-wrapper">
                                        <input type="range" id="filter-buy-day-change-min" class="slider" min="-20" max="20" step="0.1" value="-10" disabled>
                                    </div>
                                    <span class="slider-value" id="filter-buy-day-change-max-value">10%</span>
                                    <div class="slider-wrapper">
                                        <input type="range" id="filter-buy-day-change-max" class="slider" min="-20" max="20" step="0.1" value="10" disabled>
                                    </div>
                                </div>
                                <div class="slider-label-row">
                                    <span>-20%</span>
                                    <span>0%</span>
                                    <span>20%</span>
                                </div>
                            </div>
                        </div>
                        <div class="control-group">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                                <input type="checkbox" id="filter-enable-next-day-change" style="width: 16px; height: 16px;">
                                <div class="control-label" style="margin: 0;">第二天涨跌范围</div>
                            </div>
                            <div class="slider-group">
                                <div class="slider-container">
                                    <span class="slider-value" id="filter-next-day-change-min-value">-10%</span>
                                    <div class="slider-wrapper">
                                        <input type="range" id="filter-next-day-change-min" class="slider" min="-20" max="20" step="0.1" value="-10" disabled>
                                    </div>
                                    <span class="slider-value" id="filter-next-day-change-max-value">10%</span>
                                    <div class="slider-wrapper">
                                        <input type="range" id="filter-next-day-change-max" class="slider" min="-20" max="20" step="0.1" value="10" disabled>
                                    </div>
                                </div>
                                <div class="slider-label-row">
                                    <span>-20%</span>
                                    <span>0%</span>
                                    <span>20%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="controls-row">
                        <div class="control-group">
                            <div class="control-label">操作</div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn btn-primary" onclick="updateCalc()" style="flex: 1;">应用筛选</button>
                                <button class="btn btn-secondary" onclick="resetCalcFilters()" style="flex: 1;">重置</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="tabs-nav">
                    <button class="tab-btn active" data-tab="timeline">时间轴视图</button>
                    <button class="tab-btn" data-tab="matrix">收益矩阵</button>
                    <button class="tab-btn" data-tab="data-list">数据列表</button>
                </div>

                <div class="tab-content active" id="tab-timeline">
                    <div class="stats-panel" id="stats-panel">
                        <div class="stat-item">
                            <div class="stat-label">总信号数</div>
                            <div class="stat-value" id="stat-total">-</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">股票总数</div>
                            <div class="stat-value" id="stat-stocks">-</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">平均成功率</div>
                            <div class="stat-value" id="stat-success">-</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">平均最高涨幅</div>
                            <div class="stat-value positive" id="stat-highest">-</div>
                        </div>
                    </div>
                    <div class="timeline-wrapper">
                        <div class="timeline-container">
                            <div class="timeline-axis" id="timeline-axis">
                                <div class="timeline-content" id="timeline-content"></div>
                            </div>
                        </div>
                        <div class="legend">
                            <div class="legend-item">
                                <div class="legend-color legend-high"></div>
                                <span>最高价线</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color legend-low"></div>
                                <span>最低价线</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color legend-buy"></div>
                                <span>买入点</span>
                            </div>
                        </div>
                        <div class="buy-point-legend">
                            <div class="buy-point-legend-title">买入点颜色说明：</div>
                            <div class="buy-point-legend-grid">
                                <div class="legend-item">
                                    <div class="legend-color legend-buy-color-1"></div>
                                    <span>买入当天上涨 + 第二天上涨</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color legend-buy-color-2"></div>
                                    <span>买入当天下跌 + 第二天下跌</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color legend-buy-color-3"></div>
                                    <span>买入当天上涨 + 第二天下跌</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color legend-buy-color-4"></div>
                                    <span>买入当天下跌 + 第二天上涨</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color legend-buy-color-5"></div>
                                    <span>仅买入当天上涨</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color legend-buy-color-6"></div>
                                    <span>仅买入当天下跌</span>
                                </div>
                            </div>
                        </div>
                        <div class="zoom-hint">💡 提示：在时间轴上滚动鼠标滚轮可以缩放时间间距</div>
                    </div>
                </div>

                <div class="tab-content" id="tab-matrix">
                    <div class="calc-panel">
                        <div class="calc-title">📊 止盈止损收益矩阵（本金1万元/股票）</div>
                        <div class="calc-summary" id="calc-summary">
                            <div class="stat-item">
                                <div class="stat-label">总股票数</div>
                                <div class="stat-value" id="calc-total-stocks">-</div>
                            </div>
                        </div>
                        <div style="overflow-x: auto; margin-top: 16px;">
                            <table class="calc-table">
                                <thead id="calc-table-header">
                                </thead>
                                <tbody id="calc-table-body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="tab-data-list">
                    <div class="data-list-container">
                        <div id="data-list-loading" class="data-list-loading" style="display: none;">加载中...</div>
                        <div id="data-list-empty" class="data-list-empty" style="display: none;">暂无数据</div>
                        <div class="data-list-table-wrapper" id="data-list-table-wrapper" style="display: none;">
                            <table id="data-list-table" class="data-list-table">
                                <thead>
                                    <tr>
                                        <th class="sortable" onclick="sortDataList('stock_code')">股票代码</th>
                                        <th class="sortable" onclick="sortDataList('stock_name')">股票名称</th>
                                        <th class="sortable" onclick="sortDataList('signal_count')">信号数</th>
                                        <th class="sortable" onclick="sortDataList('overall_success_rate')">成功率</th>
                                        <th class="sortable" onclick="sortDataList('insert_date')">插入日期</th>
                                        <th class="sortable" onclick="sortDataList('insert_price')">插入价格</th>
                                        <th class="sortable" onclick="sortDataList('highest_change_rate')">最高涨幅</th>
                                        <th class="sortable" onclick="sortDataList('highest_price_date')">最高价日期</th>
                                        <th class="sortable" onclick="sortDataList('highest_days')">最高价天数</th>
                                        <th class="sortable" onclick="sortDataList('lowest_change_rate')">最低涨幅</th>
                                        <th class="sortable" onclick="sortDataList('lowest_price_date')">最低价日期</th>
                                        <th class="sortable" onclick="sortDataList('lowest_days')">最低价天数</th>
                                        <th class="sortable" onclick="sortDataList('buy_day_change_rate')">买入当天涨跌</th>
                                        <th class="sortable" onclick="sortDataList('next_day_change_rate')">第二天涨跌</th>
                                    </tr>
                                </thead>
                                <tbody id="data-list-table-body">
                                </tbody>
                            </table>
                        </div>
                        <div class="data-list-pagination" id="data-list-pagination" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>&copy; 2024 股票信号分析系统. 版权所有.</p>
            <p style="margin-top: 8px; font-size: 12px; color: #999;">本系统仅供学习和研究使用，不构成任何投资建议。</p>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/calendar.js') }}"></script>
</body>
</html>