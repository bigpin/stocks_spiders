# 股票信号产出规则

## 概述

系统基于技术指标分析，自动检测股票买入信号。信号检测分为两个阶段：
1. **历史信号统计**：遍历历史数据，统计各信号类型的成功率和出现次数
2. **最近3天信号筛选**：从最近3个交易日中筛选高胜率信号

## 前置条件

- **数据要求**：至少需要 16 天的历史K线数据
- **输出条件**：只有当最近3天出现**6种以上不同信号类型**时，才会输出报告

## 信号类型及检测规则

### 1. KDJ 信号

#### KDJ超卖 (`kdj_oversold`)
- **条件**：`K_9_3 < 20` 且 `D_9_3 < 20`
- **含义**：KDJ指标进入超卖区域，可能反弹

#### KDJ金叉 (`kdj_golden_cross`)
- **条件**：前一日 `K < D`，当日 `K > D`（K线上穿D线）
- **含义**：短期动能转强

#### KDJ底背离 (`kdj_divergence`)
- **条件**：价格创新低，但K值未创新低
- **含义**：下跌动能减弱，可能反转

### 2. MACD 信号

#### MACD金叉 (`macd_golden_cross`)
- **条件**：前一日 `MACD < MACD信号线`，当日 `MACD > MACD信号线`
- **含义**：趋势转强信号

#### MACD零轴上穿 (`macd_zero_cross`)
- **条件**：前一日 `MACD < 0`，当日 `MACD > 0`
- **含义**：从负值转为正值，动能转强

#### MACD底背离 (`macd_divergence`)
- **条件**：价格创新低，但MACD未创新低
- **含义**：下跌动能减弱

### 3. RSI 信号

#### RSI超卖 (`rsi_oversold`)
- **条件**：`RSI_6 < 20`
- **含义**：相对强弱指标超卖，可能反弹

#### RSI金叉 (`rsi_golden_cross`)
- **条件**：前一日 `RSI_6 < RSI_12`，当日 `RSI_6 > RSI_12`
- **含义**：短期RSI上穿长期RSI，动能转强

### 4. BOLL（布林带）信号

#### BOLL下轨支撑 (`boll_bottom_touch`)
- **条件**：收盘价 `<= 下轨 * 1.01`（接近或触及下轨）
- **含义**：价格触及下轨，可能反弹

#### BOLL带宽扩张 (`boll_width_expand`)
- **条件**：当日带宽 `> 前一日带宽 * 1.1`（带宽扩张10%以上）
- **含义**：波动性增加，可能有大行情

### 5. MA（移动平均线）信号

#### MA5上穿MA20 (`ma_golden_cross`)
- **条件**：前一日 `MA5 < MA20`，当日 `MA5 > MA20`
- **含义**：短期均线上穿长期均线，趋势转强

#### MA20支撑 (`ma_support`)
- **条件**：收盘价在 `MA20 * 0.99` 到 `MA20 * 1.01` 之间（接近MA20）
- **含义**：价格在均线支撑位附近，可能反弹

### 6. DMI 信号

#### DMI金叉 (`dmi_golden_cross`)
- **条件**：前一日 `DI+ < DI-`，当日 `DI+ > DI-`，且 `ADX > 20`
- **含义**：上升趋势转强，且趋势强度足够

#### ADX强势 (`dmi_adx_strong`)
- **条件**：`ADX > 30`
- **含义**：趋势强度高，趋势明确

### 7. CCI 信号

#### CCI超卖 (`cci_oversold`)
- **条件**：`CCI_20 < -100`
- **含义**：商品通道指标超卖，可能反弹

#### CCI零轴上穿 (`cci_zero_cross`)
- **条件**：前一日 `CCI < 0`，当日 `CCI > 0`
- **含义**：从负值转为正值，动能转强

### 8. ROC 信号

#### ROC零轴上穿 (`roc_zero_cross`)
- **条件**：前一日 `ROC_12 < 0`，当日 `ROC_12 > 0`
- **含义**：变动率从负转正，动能转强

#### ROC底背离 (`roc_divergence`)
- **条件**：价格创新低，但ROC未创新低
- **含义**：下跌动能减弱

## 成功率计算规则

### 成功定义
- **标准**：信号出现后，未来14天内最高涨幅达到 **5%** 以上
- **计算方式**：`max_return = (未来14天最高价 - 信号日收盘价) / 信号日收盘价 * 100`

### 统计指标
- **信号胜率**：该信号类型历史成功率 = `成功次数 / 总出现次数 * 100`
- **整体胜率**：所有信号类型的综合成功率 = `总成功次数 / 总信号数 * 100`

## 最近3天信号筛选规则

### 筛选条件（必须同时满足）
1. **历史样本充足**：该信号类型历史出现次数 `> 8` 次
2. **信号胜率达标**：该信号类型历史成功率 `>= 60%`
3. **整体胜率达标**：所有信号类型的整体成功率 `>= 50%`

### 时间范围
- **检测窗口**：最近3个交易日（排除周末）
- **日期匹配**：最后一个交易日必须与报告日期一致

## 输出规则

### 报告生成条件
1. 最近3天至少出现 **6种以上不同信号类型**
2. 满足筛选条件的信号才会被输出

### 报告内容
- **汇总信息**：
  - 总体成功率
  - 总信号数（历史所有信号）
  - 总成功数
- **最近信号详情**：
  - 信号数量统计（按类型分组）
  - 每个信号的详细信息（日期、类型、胜率、指标值等）

## 技术指标参数配置

| 指标 | 参数 | 说明 |
|------|------|------|
| KDJ | period=9, signal=3 | 9日周期，3日平滑 |
| MACD | fast=12, slow=26, signal=9 | 快线12，慢线26，信号线9 |
| RSI | periods=[6, 12, 24] | 6日、12日、24日 |
| BOLL | period=20, std=2 | 20日周期，2倍标准差 |
| MA | periods=[5, 10, 20, 30, 60] | 5日、10日、20日、30日、60日均线 |
| DMI | length=14, signal=14 | 14日周期 |
| CCI | length=20 | 20日周期 |
| ROC | length=12 | 12日周期 |

## 示例：sh601231 (2026-01-15)

根据报告文件，该股票在最近3天检测到：
- **9个信号事件**，**6种信号类型**：
  1. KDJ超卖：2个（2026-01-13, 2026-01-14）
  2. ADX强势：3个（2026-01-13, 2026-01-14, 2026-01-15）
  3. KDJ金叉：1个（2026-01-14）
  4. RSI金叉：1个（2026-01-15）
  5. CCI零轴上穿：1个（2026-01-15）
  6. ROC零轴上穿：1个（2026-01-15）

- **整体胜率**：66.20%
- **总信号数**：361（历史累计）
- **总成功数**：239

## 注意事项

1. **数据质量**：信号检测依赖技术指标计算的准确性，需要足够的历史数据
2. **市场环境**：信号成功率受市场环境影响，不同市场阶段表现可能不同
3. **风险提示**：技术指标信号仅供参考，不构成投资建议
4. **时间窗口**：成功判断基于未来14天，实际持有时间可能不同
